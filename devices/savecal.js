//savecal.js
//19 dec 2016
//Write calibrations to ROM
//for LSM9DS1
var CalPage=99; //ROM page where calibration is saved

var mag='[{"scale":4,"regvalue":0,"mres":[0.000122,0.000122,0.000122],"moff":[2015.3,-756.5,1002.4]},{"scale":8,"regvalue":32,"mres":[0.000244,0.000244,0.000244],"moff":[1025.2,-371.7,485.1]},{"scale":12,"regvalue":64,"mres":[0.000366,0.000366,0.000366],"moff":[686.2,-231,311.95]},{"scale":16,"regvalue":96,"mres":[0.000488,0.000488,0.000488],"moff":[521.9,-168.4,228.1]}]';

var gyro='[{"scale":245,"regvalue":0,"gres":[0.00747680664,0.00747680664,0.00747680664],"goff":[-607.19354838709,139.51612903225,-89.25806451612]},{"scale":500,"regvalue":8,"gres":[0.01525878906,0.01525878906,0.01525878906],"goff":[-328.21875,88.3125,-15.21875]},{"scale":2000,"regvalue":24,"gres":[0.06103515625,0.06103515625,0.06103515625],"goff":[-62.29032258064,40.48387096774,11.32258064516]}]';

var accel='[{"scale":2,"regvalue":0,"ares":[0.00006103515,0.00006103515,0.00006103515],"aoff":[-756.3125,-617,618.625]},{"scale":4,"regvalue":16,"ares":[0.00012207031,0.00012207031,0.00012207031],"aoff":[-434.53125,-267.84375,270.34375]},{"scale":8,"regvalue":24,"ares":[0.00024414062,0.00024414062,0.00024414062],"aoff":[-202.93548387096,-133.64516129032,135.38709677419]},{"scale":16,"regvalue":8,"ares":[0.00048828125,0.00048828125,0.00048828125],"aoff":[-62.77419354838,-35.61290322580,-646.35483870967]}]';

mag=mag+';'+gyro+';'+accel;
var f = new (require("FlashEEPROM"))();
f.write(CalPage, mag);
var mmag=E.toString(f.read(CalPage));
var arr = mmag.split(";");

console.log(arr[0]);
console.log(arr[1]);
console.log(arr[2]);

